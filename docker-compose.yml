version: '2'
services:
  web:
    restart: always
    build: web/
    ports:
      - '80:80'
    #  - '8080:8080'
    volumes:
      - ./claroline:/var/www/html/claroline:rw
    environment:
      VIRTUAL_HOST: http://claroline.loc
      #TCP_PORTS: '8080'
      #VIRTUAL_HOST: http://claroline.loc, https://claroline.loc

  webpack:
     restart: always
     image: bsolut/webpack
     ports:
       - '127.0.0.1:8080:8080'
     volumes:
       - ./claroline:/var/www
     command: "node_modules/webpack-dev-server/bin/webpack-dev-server.js --hot --inline --content-base web --claro-tgt=watch --display-error-details"
     environment:
       TMPDIR: '/tmp'

  db:
    restart: always
    image: mysql:5.7
    volumes:
      #- ./mysql/my.cnf:/etc/mysql/conf.d/my.cnf
      - mysql:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: root
      MYSQL_USER: claroline
      MYSQL_PASSWORD: claroline
      MYSQL_DATABASE: claroline



  #elasticsearch:
  #   restart: always
  #   image: elasticsearch:5.0
  #   networks:
  #     - elk
  #   ports:
  #     - '9200:9200'
  #     - '9300:9300'
  #
  # logstash:
  #   restart: always
  #   image: logstash:5.0
  #   ports:
  #     - '12201:12201'
  #   networks:
  #     - elk
  #   links:
  #     - elasticsearch
  #   environment:
  #     - 'input { gelf { codec => "json" } } output { elasticsearch { hosts => "elasticsearch:9200" } }'
  #
  # kibana:
  #   restart: always
  #   image: kibana:5.0
  #   networks:
  #     - elk
  #   links:
  #     - elasticsearch
  #   ports:
  #     - '5601:5601'

  # tools:
  #   build: tools/
  #   volumes:
  #     - data:/var/www/html/claroline

volumes:
  mysql:
  data:
